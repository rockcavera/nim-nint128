import nint128

# UInt128

const
  u_2 = UInt128(hi: 0'u64, lo: 2'u64)
  u_4294967296 = UInt128(hi: 0'u64, lo: 4294967296'u64)
  u_18446744073709551614 = UInt128(hi: 0'u64, lo: 0xFFFFFFFFFFFFFFFE'u64)
  u_18446744073709551615 = UInt128(hi: 0'u64, lo: 0xFFFFFFFFFFFFFFFF'u64)
  u_18446744073709551616 = UInt128(hi: 1'u64, lo: 0'u64)
  u_18446744073709551617 = UInt128(hi: 1'u64, lo: 1'u64)
  u_36893488147419103230 = UInt128(hi: 1'u64, lo: 0xFFFFFFFFFFFFFFFE'u64)
  u_36893488147419103231 = UInt128(hi: 1'u64, lo: 0xFFFFFFFFFFFFFFFF'u64)
  u_79228162514264337589248983040 = UInt128(hi: 0xFFFFFFFF'u64, lo: 0xFFFFFFFF00000000'u64)
  u_340282366920938463426481119284349108224 = UInt128(hi: 0xFFFFFFFFFFFFFFFE'u64, lo: 0'u64)
  u_340282366920938463426481119284349108225 = UInt128(hi: 0xFFFFFFFFFFFFFFFE'u64, lo: 1'u64)
  u_340282366920938463444927863358058659839 = UInt128(hi: 0xFFFFFFFFFFFFFFFE'u64, lo: 0xFFFFFFFFFFFFFFFF'u64)
  u_340282366920938463444927863358058659840 = UInt128(hi: 0xFFFFFFFFFFFFFFFF'u64, lo: 0'u64)
  u_340282366920938463444927863358058659841 = UInt128(hi: 0xFFFFFFFFFFFFFFFF'u64, lo: 1'u64)
  u_340282366920938463444927863358058659842 = UInt128(hi: 0xFFFFFFFFFFFFFFFF'u64, lo: 2'u64)
  u_340282366920938463463374607431768211454 = UInt128(hi: 0xFFFFFFFFFFFFFFFF'u64, lo: 0xFFFFFFFFFFFFFFFE'u64)

block uint128_plus:
  doAssert (zero(UInt128) + zero(UInt128)) == zero(UInt128)
  doAssert (zero(UInt128) + one(UInt128)) == one(UInt128)
  doAssert (zero(UInt128) + u_18446744073709551615) == u_18446744073709551615
  doAssert (zero(UInt128) + u_340282366920938463444927863358058659840) == u_340282366920938463444927863358058659840
  doAssert (zero(UInt128) + high(UInt128)) == high(UInt128)

  doAssert (one(UInt128) + zero(UInt128)) == one(UInt128)
  doAssert (one(UInt128) + one(UInt128)) == u_2
  doAssert (one(UInt128) + u_18446744073709551615) == u_18446744073709551616
  doAssert (one(UInt128) + u_340282366920938463444927863358058659840) == u_340282366920938463444927863358058659841
  doAssert (one(UInt128) + high(UInt128)) == zero(UInt128)

  doAssert (u_18446744073709551615 + zero(UInt128)) == u_18446744073709551615
  doAssert (u_18446744073709551615 + one(UInt128)) == u_18446744073709551616
  doAssert (u_18446744073709551615 + u_18446744073709551615) == u_36893488147419103230
  doAssert (u_18446744073709551615 + u_340282366920938463444927863358058659840) == high(UInt128)
  doAssert (u_18446744073709551615 + high(UInt128)) == u_18446744073709551614

  doAssert (u_340282366920938463444927863358058659840 + zero(UInt128)) == u_340282366920938463444927863358058659840
  doAssert (u_340282366920938463444927863358058659840 + one(UInt128)) == u_340282366920938463444927863358058659841
  doAssert (u_340282366920938463444927863358058659840 + u_18446744073709551615) == high(UInt128)
  doAssert (u_340282366920938463444927863358058659840 + u_340282366920938463444927863358058659840) == u_340282366920938463426481119284349108224
  doAssert (u_340282366920938463444927863358058659840 + high(UInt128)) == u_340282366920938463444927863358058659839

  doAssert (high(UInt128) + zero(UInt128)) == high(UInt128)
  doAssert (high(UInt128) + one(UInt128)) == zero(UInt128)
  doAssert (high(UInt128) + u_18446744073709551615) == u_18446744073709551614
  doAssert (high(UInt128) + u_340282366920938463444927863358058659840) == u_340282366920938463444927863358058659839
  doAssert (high(UInt128) + high(UInt128)) == u_340282366920938463463374607431768211454

block uint128_unaryMinus:
  doAssert -zero(UInt128) == zero(UInt128)
  doAssert -one(UInt128) == high(UInt128)
  doAssert -u_18446744073709551615 == u_340282366920938463444927863358058659841
  doAssert -u_340282366920938463444927863358058659840 == u_18446744073709551616
  doAssert -high(UInt128) == one(UInt128)

block uint128_minus:
  doAssert (zero(UInt128) - zero(UInt128)) == zero(UInt128)
  doAssert (zero(UInt128) - one(UInt128)) == high(UInt128)
  doAssert (zero(UInt128) - u_18446744073709551615) == u_340282366920938463444927863358058659841
  doAssert (zero(UInt128) - u_340282366920938463444927863358058659840) == u_18446744073709551616
  doAssert (zero(UInt128) - high(UInt128)) == one(UInt128)

  doAssert (one(UInt128) - zero(UInt128)) == one(UInt128)
  doAssert (one(UInt128) - one(UInt128)) == zero(UInt128)
  doAssert (one(UInt128) - u_18446744073709551615) == u_340282366920938463444927863358058659842
  doAssert (one(UInt128) - u_340282366920938463444927863358058659840) == u_18446744073709551617
  doAssert (one(UInt128) - high(UInt128)) == u_2

  doAssert (u_18446744073709551615 - zero(UInt128)) == u_18446744073709551615
  doAssert (u_18446744073709551615 - one(UInt128)) == u_18446744073709551614
  doAssert (u_18446744073709551615 - u_18446744073709551615) == zero(UInt128)
  doAssert (u_18446744073709551615 - u_340282366920938463444927863358058659840) == u_36893488147419103231
  doAssert (u_18446744073709551615 - high(UInt128)) == u_18446744073709551616

  doAssert (u_340282366920938463444927863358058659840 - zero(UInt128)) == u_340282366920938463444927863358058659840
  doAssert (u_340282366920938463444927863358058659840 - one(UInt128)) == u_340282366920938463444927863358058659839
  doAssert (u_340282366920938463444927863358058659840 - u_18446744073709551615) == u_340282366920938463426481119284349108225
  doAssert (u_340282366920938463444927863358058659840 - u_340282366920938463444927863358058659840) == zero(UInt128)
  doAssert (u_340282366920938463444927863358058659840 - high(UInt128)) == u_340282366920938463444927863358058659841

  doAssert (high(UInt128) - zero(UInt128)) == high(UInt128)
  doAssert (high(UInt128) - one(UInt128)) == u_340282366920938463463374607431768211454
  doAssert (high(UInt128) - u_18446744073709551615) == u_340282366920938463444927863358058659840
  doAssert (high(UInt128) - u_340282366920938463444927863358058659840) == u_18446744073709551615
  doAssert (high(UInt128) - high(UInt128)) == zero(UInt128)

block uint128_mul64by64To128:
  var vu128: UInt128

  vu128 = mul64by64To128(0'u64, 0'u64)
  doAssert vu128 == zero(UInt128)
  vu128 = mul64by64To128(0'u64, 1'u64)
  doAssert vu128 == zero(UInt128)
  vu128 = mul64by64To128(0'u64, 4294967296'u64)
  doAssert vu128 == zero(UInt128)
  vu128 = mul64by64To128(0'u64, 0xFFFFFFFFFFFFFFFF'u64)
  doAssert vu128 == zero(UInt128)

  vu128 = mul64by64To128(1'u64, 0'u64)
  doAssert vu128 == zero(UInt128)
  vu128 = mul64by64To128(1'u64, 1'u64)
  doAssert vu128 == one(UInt128)
  vu128 = mul64by64To128(1'u64, 4294967296'u64)
  doAssert vu128 == u_4294967296
  vu128 = mul64by64To128(1'u64, 0xFFFFFFFFFFFFFFFF'u64)
  doAssert vu128 == u_18446744073709551615

  vu128 = mul64by64To128(4294967296'u64, 0'u64)
  doAssert vu128 == zero(UInt128)
  vu128 = mul64by64To128(4294967296'u64, 1'u64)
  doAssert vu128 == u_4294967296
  vu128 = mul64by64To128(4294967296'u64, 4294967296'u64)
  doAssert vu128 == u_18446744073709551616
  vu128 = mul64by64To128(4294967296'u64, 0xFFFFFFFFFFFFFFFF'u64)
  doAssert vu128 == u_79228162514264337589248983040

  vu128 = mul64by64To128(0xFFFFFFFFFFFFFFFF'u64, 0'u64)
  doAssert vu128 == zero(UInt128)
  vu128 = mul64by64To128(0xFFFFFFFFFFFFFFFF'u64, 1'u64)
  doAssert vu128 == u_18446744073709551615
  vu128 = mul64by64To128(0xFFFFFFFFFFFFFFFF'u64, 4294967296'u64)
  doAssert vu128 == u_79228162514264337589248983040
  vu128 = mul64by64To128(0xFFFFFFFFFFFFFFFF'u64, 0xFFFFFFFFFFFFFFFF'u64)
  doAssert vu128 == u_340282366920938463426481119284349108225

block uint128_start:
  doAssert (zero(UInt128) * zero(UInt128)) == zero(UInt128)
  doAssert (zero(UInt128) * one(UInt128)) == zero(UInt128)
  doAssert (zero(UInt128) * u_18446744073709551615) == zero(UInt128)
  doAssert (zero(UInt128) * u_340282366920938463444927863358058659840) == zero(UInt128)
  doAssert (zero(UInt128) * high(UInt128)) == zero(UInt128)

  doAssert (one(UInt128) * zero(UInt128)) == zero(UInt128)
  doAssert (one(UInt128) * one(UInt128)) == one(UInt128)
  doAssert (one(UInt128) * u_18446744073709551615) == u_18446744073709551615
  doAssert (one(UInt128) * u_340282366920938463444927863358058659840) == u_340282366920938463444927863358058659840
  doAssert (one(UInt128) * high(UInt128)) == high(UInt128)

  doAssert (u_18446744073709551615 * zero(UInt128)) == zero(UInt128)
  doAssert (u_18446744073709551615 * one(UInt128)) == u_18446744073709551615
  doAssert (u_18446744073709551615 * u_18446744073709551615) == u_340282366920938463426481119284349108225
  doAssert (u_18446744073709551615 * u_340282366920938463444927863358058659840) == u_18446744073709551616
  doAssert (u_18446744073709551615 * high(UInt128)) == u_340282366920938463444927863358058659841

  doAssert (u_340282366920938463444927863358058659840 * zero(UInt128)) == zero(UInt128)
  doAssert (u_340282366920938463444927863358058659840 * one(UInt128)) == u_340282366920938463444927863358058659840
  doAssert (u_340282366920938463444927863358058659840 * u_18446744073709551615) == u_18446744073709551616
  doAssert (u_340282366920938463444927863358058659840 * u_340282366920938463444927863358058659840) == zero(UInt128)
  doAssert (u_340282366920938463444927863358058659840 * high(UInt128)) == u_18446744073709551616

  doAssert (high(UInt128) * zero(UInt128)) == zero(UInt128)
  doAssert (high(UInt128) * one(UInt128)) == high(UInt128)
  doAssert (high(UInt128) * u_18446744073709551615) == u_340282366920938463444927863358058659841
  doAssert (high(UInt128) * u_340282366920938463444927863358058659840) == u_18446744073709551616
  doAssert (high(UInt128) * high(UInt128)) == one(UInt128)

block uint128_divmod:
  doAssert divmod(zero(UInt128), one(UInt128)) == (zero(UInt128), zero(UInt128))
  doAssert divmod(zero(UInt128), u_18446744073709551615) == (zero(UInt128), zero(UInt128))
  doAssert divmod(zero(UInt128), u_340282366920938463444927863358058659840) == (zero(UInt128), zero(UInt128))
  doAssert divmod(zero(UInt128), high(UInt128)) == (zero(UInt128), zero(UInt128))

  doAssert divmod(one(UInt128), one(UInt128)) == (one(UInt128), zero(UInt128))
  doAssert divmod(one(UInt128), u_18446744073709551615) == (zero(UInt128), one(UInt128))
  doAssert divmod(one(UInt128), u_340282366920938463444927863358058659840) == (zero(UInt128), one(UInt128))
  doAssert divmod(one(UInt128), high(UInt128)) == (zero(UInt128), one(UInt128))

  doAssert divmod(u_18446744073709551615, one(UInt128)) == (u_18446744073709551615, zero(UInt128))
  doAssert divmod(u_18446744073709551615, u_18446744073709551615) == (one(UInt128), zero(UInt128))
  doAssert divmod(u_18446744073709551615, u_340282366920938463444927863358058659840) == (zero(UInt128), u_18446744073709551615)
  doAssert divmod(u_18446744073709551615, high(UInt128)) == (zero(UInt128), u_18446744073709551615)

  doAssert divmod(u_340282366920938463444927863358058659840, one(UInt128)) == (u_340282366920938463444927863358058659840, zero(UInt128))
  doAssert divmod(u_340282366920938463444927863358058659840, u_18446744073709551615) == (u_18446744073709551616, zero(UInt128))
  doAssert divmod(u_340282366920938463444927863358058659840, u_340282366920938463444927863358058659840) == (one(UInt128), zero(UInt128))
  doAssert divmod(u_340282366920938463444927863358058659840, high(UInt128)) == (zero(UInt128), u_340282366920938463444927863358058659840)

  doAssert divmod(high(UInt128), one(UInt128)) == (high(UInt128), zero(UInt128))
  doAssert divmod(high(UInt128), u_18446744073709551615) == (u_18446744073709551617, zero(UInt128))
  doAssert divmod(high(UInt128), u_340282366920938463444927863358058659840) == (one(UInt128), u_18446744073709551615)
  doAssert divmod(high(UInt128), high(UInt128)) == (one(UInt128), zero(UInt128))

# Int128

const
  i_2 = Int128(hi: 0'i64, lo: 2'u64)
  i_18446744073709551614 = Int128(hi: 0'i64, lo: 0xFFFFFFFFFFFFFFFE'u64)
  i_18446744073709551615 = Int128(hi: 0'i64, lo: 0xFFFFFFFFFFFFFFFF'u64)
  i_36893488147419103230 = Int128(hi: 1'i64, lo: 0xFFFFFFFFFFFFFFFE'u64)
  i_36893488147419103231 = Int128(hi: 1'i64, lo: high(uint64))
  i_36893488147419103232 = Int128(hi: 2'i64, lo: 0'u64)
  i_18446744073709551616 = Int128(hi: 1'i64, lo: 0'u64)
  i_18446744073709551617 = Int128(hi: 1'i64, lo: 1'u64)
  i_21267647932558653929567424817066409984 = Int128(hi: 1152921504606846974'i64, lo: 0'u64)
  i_21267647932558653929567424817066409985 = Int128(hi: 1152921504606846974'i64, lo: 1'u64)
  i_21267647932558653948014168890775961599 = Int128(hi: 1152921504606846974'i64, lo: high(uint64))
  i_21267647932558653948014168890775961600 = Int128(hi: 0xFFFFFFFFFFFFFFF'i64, lo: 0'u64)
  i_21267647932558653948014168890775961601 = Int128(hi: 1152921504606846975'i64, lo: 1'u64)
  i_21267647932558653966460912964485513215 = Int128(hi: 1152921504606846975'i64, lo: high(uint64))
  i_21267647932558653966460912964485513216 = Int128(hi: 1152921504606846976'i64, lo: 0'u64)
  i_42535295865117307896028337781551923200 = Int128(hi: 2305843009213693950'i64, lo: 0'u64)
  i_85070591730234615861231965839514664960 = Int128(hi: 0x3FFFFFFFFFFFFFFF'i64, lo: 0xC000000000000000'u64)
  i_85070591730234615865843651857942052863 = Int128(hi: 0x3FFFFFFFFFFFFFFF'i64, lo: 0xFFFFFFFFFFFFFFFF'u64)
  i_148873535527910577783673134825108144127 = Int128(hi: 8070450532247928832'i64, lo: high(uint64))
  i_148873535527910577783673134825108144128 = Int128(hi: 8070450532247928833'i64, lo: low(uint64))
  i_148873535527910577802119878898817695743 = Int128(hi: 8070450532247928833'i64, lo: high(uint64))
  i_170141183460469231694793815568465002497 = Int128(hi: 9223372036854775806'i64, lo: 1'u64)
  i_170141183460469231694793815568465002498 = Int128(hi: 9223372036854775806'i64, lo: 2'u64)
  i_170141183460469231713240559642174554111 = Int128(hi: 9223372036854775806'i64, lo: high(uint64))
  i_170141183460469231713240559642174554112 = Int128(hi: 0x7FFFFFFFFFFFFFFF'i64, lo: 0'u64)
  i_170141183460469231713240559642174554113 = Int128(hi: 0x7FFFFFFFFFFFFFFF'i64, lo: 1'u64)
  i_170141183460469231713240559642174554114 = Int128(hi: high(int64), lo: 2'u64)
  i_170141183460469231722463931679029329920 = Int128(hi: 0x7FFFFFFFFFFFFFFF'i64, lo: 0x8000000000000000'u64)
  i_170141183460469231731687303715884105726 = Int128(hi: 0x7FFFFFFFFFFFFFFF'i64, lo: 0xFFFFFFFFFFFFFFFE'u64)

  minus_1 = Int128(hi: -1'i64, lo: 0xFFFFFFFFFFFFFFFF'u64)
  minus_2 = Int128(hi: -1'i64, lo: 0xFFFFFFFFFFFFFFFE'u64)
  minus_9223372036854775808 = Int128(hi: -1'i64, lo: 0x8000000000000000'u64)
  minus_18446744073709551614 = Int128(hi: -1'i64, lo: 2'u64)
  minus_18446744073709551615 = Int128(hi: -1'i64, lo: 1'u64)
  minus_18446744073709551616 = Int128(hi: -1'i64, lo: 0'u64)
  minus_18446744073709551617 = Int128(hi: -2'i64, lo: high(uint64))
  minus_36893488147419103230 = Int128(hi: -2'i64, lo: 2'u64)
  minus_36893488147419103231 = Int128(hi: -2'i64, lo: 1'u64)
  minus_36893488147419103232 = Int128(hi: -2'i64, lo: 0'u64)
  minus_21267647932558653929567424817066409984 = Int128(hi: -1152921504606846974'i64, lo: low(uint64))
  minus_21267647932558653929567424817066409985 = Int128(hi: -1152921504606846975'i64, lo: high(uint64))
  minus_21267647932558653948014168890775961599 = Int128(hi: -1152921504606846975'i64, lo: 1'u64)
  minus_21267647932558653948014168890775961600 = Int128(hi: -1152921504606846975'i64, lo: low(uint64))
  minus_21267647932558653948014168890775961601 = Int128(hi: -1152921504606846976'i64, lo: high(uint64))
  minus_21267647932558653966460912964485513215 = Int128(hi: -1152921504606846976'i64, lo: 1'u64)
  minus_21267647932558653966460912964485513216 = Int128(hi: -1152921504606846976'i64, lo: low(uint64))
  minus_85070591730234615865843651857942052864 = Int128(hi: -0x4000000000000000'i64, lo: 0'u64)
  minus_148873535527910577765226390751398592513 = Int128(hi: -8070450532247928833'i64, lo: 0xFFFFFFFFFFFFFFFF'u64)
  minus_148873535527910577783673134825108144127 = Int128(hi: -8070450532247928833'i64, lo: 1'u64)
  minus_148873535527910577783673134825108144128 = Int128(hi: -0x7000000000000001'i64, lo: 0'u64)
  minus_148873535527910577783673134825108144129 = Int128(hi: -8070450532247928834'i64, lo: high(uint64))
  minus_148873535527910577802119878898817695743 = Int128(hi: -8070450532247928834'i64, lo: 1'u64)
  minus_170141183460469231694793815568465002497 = Int128(hi: -9223372036854775807, lo: 0xFFFFFFFFFFFFFFFF'u64)
  minus_170141183460469231694793815568465002498 = Int128(hi: -9223372036854775807, lo: 0xFFFFFFFFFFFFFFFE'u64)
  minus_170141183460469231713240559642174554111 = Int128(hi: -9223372036854775807'i64, lo: 1'u64)
  minus_170141183460469231713240559642174554112 = Int128(hi: -9223372036854775807, lo: 0'u64)
  minus_170141183460469231713240559642174554113 = Int128(hi: low(int64), lo: 0xFFFFFFFFFFFFFFFF'u64)
  minus_170141183460469231713240559642174554114 = Int128(hi: low(int64), lo: 0xFFFFFFFFFFFFFFFE'u64)
  minus_170141183460469231731687303715884105726 = Int128(hi: low(int64), lo: 2'u64)
  minus_170141183460469231731687303715884105727 = Int128(hi: low(int64), lo: 1'u64)

block int128_plus:
  when defined(danger):
    doAssert (low(Int128) + low(Int128)) == zero(Int128) # OverflowDefect
    doAssert (low(Int128) + minus_170141183460469231713240559642174554113) == i_18446744073709551615 # OverflowDefect
    doAssert (low(Int128) + minus_18446744073709551616) == i_170141183460469231713240559642174554112 # OverflowDefect - Error compiling with --cpu:i386
    doAssert (low(Int128) + minus_18446744073709551615) == i_170141183460469231713240559642174554113 # OverflowDefect
    doAssert (low(Int128) + minus_1) == high(Int128) # OverflowDefect
  doAssert (low(Int128) + zero(Int128)) == low(Int128)
  doAssert (low(Int128) + one(Int128)) == minus_170141183460469231731687303715884105727
  doAssert (low(Int128) + i_18446744073709551615) == minus_170141183460469231713240559642174554113
  doAssert (low(Int128) + i_18446744073709551616) == minus_170141183460469231713240559642174554112
  doAssert (low(Int128) + i_21267647932558653948014168890775961600) == minus_148873535527910577783673134825108144128
  doAssert (low(Int128) + high(Int128)) == minus_1

  when defined(danger):
    doAssert (minus_170141183460469231713240559642174554113 + low(Int128)) == i_18446744073709551615
    doAssert (minus_170141183460469231713240559642174554113 + minus_170141183460469231713240559642174554113) == i_36893488147419103230
    doAssert (minus_170141183460469231713240559642174554113 + minus_18446744073709551616) == high(Int128)
    doAssert (minus_170141183460469231713240559642174554113 + minus_18446744073709551615) == low(Int128)
    doAssert (minus_170141183460469231713240559642174554113 + minus_1) == minus_170141183460469231713240559642174554114
  doAssert (minus_170141183460469231713240559642174554113 + zero(Int128)) == minus_170141183460469231713240559642174554113
  doAssert (minus_170141183460469231713240559642174554113 + one(Int128)) == minus_170141183460469231713240559642174554112
  doAssert (minus_170141183460469231713240559642174554113 + i_18446744073709551615) == minus_170141183460469231694793815568465002498
  doAssert (minus_170141183460469231713240559642174554113 + i_18446744073709551616) == minus_170141183460469231694793815568465002497
  doAssert (minus_170141183460469231713240559642174554113 + i_21267647932558653948014168890775961600) == minus_148873535527910577765226390751398592513
  doAssert (minus_170141183460469231713240559642174554113 + high(Int128)) == i_18446744073709551614

  when defined(danger):
    doAssert (minus_18446744073709551616 + low(Int128)) == i_170141183460469231713240559642174554112 # Error compiling with --cpu:i386
    doAssert (minus_18446744073709551616 + minus_170141183460469231713240559642174554113) == high(Int128)
  doAssert (minus_18446744073709551616 + minus_18446744073709551616) == minus_36893488147419103232
  doAssert (minus_18446744073709551616 + minus_18446744073709551615) == minus_36893488147419103231
  doAssert (minus_18446744073709551616 + minus_1) == minus_18446744073709551617
  doAssert (minus_18446744073709551616 + zero(Int128)) == minus_18446744073709551616
  doAssert (minus_18446744073709551616 + one(Int128)) == minus_18446744073709551615
  doAssert (minus_18446744073709551616 + i_18446744073709551615) == minus_1
  doAssert (minus_18446744073709551616 + i_18446744073709551616) == zero(Int128)
  doAssert (minus_18446744073709551616 + i_21267647932558653948014168890775961600) == i_21267647932558653929567424817066409984
  doAssert (minus_18446744073709551616 + high(Int128)) == i_170141183460469231713240559642174554111

  when defined(danger):
    doAssert (minus_18446744073709551615 + low(Int128)) == i_170141183460469231713240559642174554113
    doAssert (minus_18446744073709551615 + minus_170141183460469231713240559642174554113) == low(Int128)
  doAssert (minus_18446744073709551615 + minus_18446744073709551616) == minus_36893488147419103231
  doAssert (minus_18446744073709551615 + minus_18446744073709551615) == minus_36893488147419103230
  doAssert (minus_18446744073709551615 + minus_1) == minus_18446744073709551616
  doAssert (minus_18446744073709551615 + zero(Int128)) == minus_18446744073709551615
  doAssert (minus_18446744073709551615 + one(Int128)) == minus_18446744073709551614
  doAssert (minus_18446744073709551615 + i_18446744073709551615) == zero(Int128)
  doAssert (minus_18446744073709551615 + i_18446744073709551616) == one(Int128)
  doAssert (minus_18446744073709551615 + i_21267647932558653948014168890775961600) == i_21267647932558653929567424817066409985
  doAssert (minus_18446744073709551615 + high(Int128)) == i_170141183460469231713240559642174554112

  when defined(danger):
    doAssert (minus_1 + low(Int128)) == high(Int128)
    doAssert (minus_1 + minus_170141183460469231713240559642174554113) == minus_170141183460469231713240559642174554114
  doAssert (minus_1 + minus_18446744073709551616) == minus_18446744073709551617
  doAssert (minus_1 + minus_18446744073709551615) == minus_18446744073709551616
  doAssert (minus_1 + minus_1) == minus_2
  doAssert (minus_1 + zero(Int128)) == minus_1
  doAssert (minus_1 + one(Int128)) == zero(Int128)
  doAssert (minus_1 + i_18446744073709551615) == i_18446744073709551614
  doAssert (minus_1 + i_18446744073709551616) == i_18446744073709551615
  doAssert (minus_1 + i_21267647932558653948014168890775961600) == i_21267647932558653948014168890775961599
  doAssert (minus_1 + high(Int128)) == i_170141183460469231731687303715884105726

  doAssert (zero(Int128) + low(Int128)) == low(Int128)
  doAssert (zero(Int128) + minus_170141183460469231713240559642174554113) == minus_170141183460469231713240559642174554113
  doAssert (zero(Int128) + minus_18446744073709551616) == minus_18446744073709551616
  doAssert (zero(Int128) + minus_18446744073709551615) == minus_18446744073709551615
  doAssert (zero(Int128) + minus_1) == minus_1
  doAssert (zero(Int128) + zero(Int128)) == zero(Int128)
  doAssert (zero(Int128) + one(Int128)) == one(Int128)
  doAssert (zero(Int128) + i_18446744073709551615) == i_18446744073709551615
  doAssert (zero(Int128) + i_18446744073709551616) == i_18446744073709551616
  doAssert (zero(Int128) + i_21267647932558653948014168890775961600) == i_21267647932558653948014168890775961600
  doAssert (zero(Int128) + high(Int128)) == high(Int128)

  doAssert (one(Int128) + low(Int128)) == minus_170141183460469231731687303715884105727
  doAssert (one(Int128) + minus_170141183460469231713240559642174554113) == minus_170141183460469231713240559642174554112
  doAssert (one(Int128) + minus_18446744073709551616) == minus_18446744073709551615
  doAssert (one(Int128) + minus_18446744073709551615) == minus_18446744073709551614
  doAssert (one(Int128) + minus_1) == zero(Int128)
  doAssert (one(Int128) + zero(Int128)) == one(Int128)
  doAssert (one(Int128) + one(Int128)) == i_2
  doAssert (one(Int128) + i_18446744073709551615) == i_18446744073709551616
  doAssert (one(Int128) + i_18446744073709551616) == i_18446744073709551617
  doAssert (one(Int128) + i_21267647932558653948014168890775961600) == i_21267647932558653948014168890775961601
  when defined(danger):
    doAssert (one(Int128) + high(Int128)) == low(Int128)

  doAssert (i_18446744073709551615 + low(Int128)) == minus_170141183460469231713240559642174554113
  doAssert (i_18446744073709551615 + minus_170141183460469231713240559642174554113) == minus_170141183460469231694793815568465002498
  doAssert (i_18446744073709551615 + minus_18446744073709551616) == minus_1
  doAssert (i_18446744073709551615 + minus_18446744073709551615) == zero(Int128)
  doAssert (i_18446744073709551615 + minus_1) == i_18446744073709551614
  doAssert (i_18446744073709551615 + zero(Int128)) == i_18446744073709551615
  doAssert (i_18446744073709551615 + one(Int128)) == i_18446744073709551616
  doAssert (i_18446744073709551615 + i_18446744073709551615) == i_36893488147419103230
  doAssert (i_18446744073709551615 + i_18446744073709551616) == i_36893488147419103231
  doAssert (i_18446744073709551615 + i_21267647932558653948014168890775961600) == i_21267647932558653966460912964485513215
  when defined(danger):
    doAssert (i_18446744073709551615 + high(Int128)) == minus_170141183460469231713240559642174554114

  doAssert (i_18446744073709551616 + low(Int128)) == minus_170141183460469231713240559642174554112
  doAssert (i_18446744073709551616 + minus_170141183460469231713240559642174554113) == minus_170141183460469231694793815568465002497
  doAssert (i_18446744073709551616 + minus_18446744073709551616) == zero(Int128)
  doAssert (i_18446744073709551616 + minus_18446744073709551615) == one(Int128)
  doAssert (i_18446744073709551616 + minus_1) == i_18446744073709551615
  doAssert (i_18446744073709551616 + zero(Int128)) == i_18446744073709551616
  doAssert (i_18446744073709551616 + one(Int128)) == i_18446744073709551617
  doAssert (i_18446744073709551616 + i_18446744073709551615) == i_36893488147419103231
  doAssert (i_18446744073709551616 + i_18446744073709551616) == i_36893488147419103232
  doAssert (i_18446744073709551616 + i_21267647932558653948014168890775961600) == i_21267647932558653966460912964485513216
  when defined(danger):
    doAssert (i_18446744073709551616 + high(Int128)) == minus_170141183460469231713240559642174554113

  doAssert (i_21267647932558653948014168890775961600 + low(Int128)) == minus_148873535527910577783673134825108144128
  doAssert (i_21267647932558653948014168890775961600 + minus_170141183460469231713240559642174554113) == minus_148873535527910577765226390751398592513
  doAssert (i_21267647932558653948014168890775961600 + minus_18446744073709551616) == i_21267647932558653929567424817066409984
  doAssert (i_21267647932558653948014168890775961600 + minus_18446744073709551615) == i_21267647932558653929567424817066409985
  doAssert (i_21267647932558653948014168890775961600 + minus_1) == i_21267647932558653948014168890775961599
  doAssert (i_21267647932558653948014168890775961600 + zero(Int128)) == i_21267647932558653948014168890775961600
  doAssert (i_21267647932558653948014168890775961600 + one(Int128)) == i_21267647932558653948014168890775961601
  doAssert (i_21267647932558653948014168890775961600 + i_18446744073709551615) == i_21267647932558653966460912964485513215
  doAssert (i_21267647932558653948014168890775961600 + i_18446744073709551616) == i_21267647932558653966460912964485513216
  doAssert (i_21267647932558653948014168890775961600 + i_21267647932558653948014168890775961600) == i_42535295865117307896028337781551923200
  when defined(danger):
    doAssert (i_21267647932558653948014168890775961600 + high(Int128)) == minus_148873535527910577783673134825108144129

  doAssert (high(Int128) + low(Int128)) == minus_1
  doAssert (high(Int128) + minus_170141183460469231713240559642174554113) == i_18446744073709551614
  doAssert (high(Int128) + minus_18446744073709551616) == i_170141183460469231713240559642174554111
  doAssert (high(Int128) + minus_18446744073709551615) == i_170141183460469231713240559642174554112
  doAssert (high(Int128) + minus_1) == i_170141183460469231731687303715884105726
  doAssert (high(Int128) + zero(Int128)) == high(Int128)
  when defined(danger):
    doAssert (high(Int128) + one(Int128)) == low(Int128)
    doAssert (high(Int128) + i_18446744073709551615) == minus_170141183460469231713240559642174554114
    doAssert (high(Int128) + i_18446744073709551616) == minus_170141183460469231713240559642174554113
    doAssert (high(Int128) + i_21267647932558653948014168890775961600) == minus_148873535527910577783673134825108144129
    doAssert (high(Int128) + high(Int128)) == minus_2

block int128_minus:
  doAssert (low(Int128) - low(Int128)) == zero(Int128) # OverflowDefect
  doAssert (low(Int128) - minus_170141183460469231713240559642174554113) == minus_18446744073709551615 # OverflowDefect
  doAssert (low(Int128) - minus_18446744073709551616) == minus_170141183460469231713240559642174554112 # OverflowDefect
  doAssert (low(Int128) - minus_18446744073709551615) == minus_170141183460469231713240559642174554113 # OverflowDefect
  doAssert (low(Int128) - minus_1) == minus_170141183460469231731687303715884105727 # OverflowDefect
  doAssert (low(Int128) - zero(Int128)) == low(Int128)
  when defined(danger):
    doAssert (low(Int128) - one(Int128)) == high(Int128)
    doAssert (low(Int128) - i_18446744073709551615) == i_170141183460469231713240559642174554113
    doAssert (low(Int128) - i_18446744073709551616) == i_170141183460469231713240559642174554112 # Error compiling with --cpu:i386
    doAssert (low(Int128) - i_21267647932558653948014168890775961600) == i_148873535527910577783673134825108144128 # Error compiling with --cpu:i386
    doAssert (low(Int128) - high(Int128)) == one(Int128)

  doAssert (minus_170141183460469231713240559642174554113 - low(Int128)) == i_18446744073709551615
  doAssert (minus_170141183460469231713240559642174554113 - minus_170141183460469231713240559642174554113) == zero(Int128)
  doAssert (minus_170141183460469231713240559642174554113 - minus_18446744073709551616) == minus_170141183460469231694793815568465002497
  doAssert (minus_170141183460469231713240559642174554113 - minus_18446744073709551615) == minus_170141183460469231694793815568465002498
  doAssert (minus_170141183460469231713240559642174554113 - minus_1) == minus_170141183460469231713240559642174554112
  doAssert (minus_170141183460469231713240559642174554113 - zero(Int128)) == minus_170141183460469231713240559642174554113
  doAssert (minus_170141183460469231713240559642174554113 - one(Int128)) == minus_170141183460469231713240559642174554114
  doAssert (minus_170141183460469231713240559642174554113 - i_18446744073709551615) == low(Int128)
  when defined(danger):
    doAssert (minus_170141183460469231713240559642174554113 - i_18446744073709551616) == high(Int128)
    doAssert (minus_170141183460469231713240559642174554113 - i_21267647932558653948014168890775961600) == i_148873535527910577802119878898817695743
    doAssert (minus_170141183460469231713240559642174554113 - high(Int128)) == i_18446744073709551616

  doAssert (minus_18446744073709551616 - low(Int128)) == i_170141183460469231713240559642174554112
  doAssert (minus_18446744073709551616 - minus_170141183460469231713240559642174554113) == i_170141183460469231694793815568465002497
  doAssert (minus_18446744073709551616 - minus_18446744073709551616) == zero(Int128)
  doAssert (minus_18446744073709551616 - minus_18446744073709551615) == minus_1
  doAssert (minus_18446744073709551616 - minus_1) == minus_18446744073709551615
  doAssert (minus_18446744073709551616 - zero(Int128)) == minus_18446744073709551616
  doAssert (minus_18446744073709551616 - one(Int128)) == minus_18446744073709551617
  doAssert (minus_18446744073709551616 - i_18446744073709551615) == minus_36893488147419103231
  doAssert (minus_18446744073709551616 - i_18446744073709551616) == minus_36893488147419103232
  doAssert (minus_18446744073709551616 - i_21267647932558653948014168890775961600) == minus_21267647932558653966460912964485513216
  when defined(danger):
    doAssert (minus_18446744073709551616 - high(Int128)) == i_170141183460469231713240559642174554113

  doAssert (minus_18446744073709551615 - low(Int128)) == i_170141183460469231713240559642174554113
  doAssert (minus_18446744073709551615 - minus_170141183460469231713240559642174554113) == i_170141183460469231694793815568465002498
  doAssert (minus_18446744073709551615 - minus_18446744073709551616) == one(Int128)
  doAssert (minus_18446744073709551615 - minus_18446744073709551615) == zero(Int128)
  doAssert (minus_18446744073709551615 - minus_1) == minus_18446744073709551614
  doAssert (minus_18446744073709551615 - zero(Int128)) == minus_18446744073709551615
  doAssert (minus_18446744073709551615 - one(Int128)) == minus_18446744073709551616
  doAssert (minus_18446744073709551615 - i_18446744073709551615) == minus_36893488147419103230
  doAssert (minus_18446744073709551615 - i_18446744073709551616) == minus_36893488147419103231
  doAssert (minus_18446744073709551615 - i_21267647932558653948014168890775961600) == minus_21267647932558653966460912964485513215
  when defined(danger):
    doAssert (minus_18446744073709551615 - high(Int128)) == i_170141183460469231713240559642174554114

  doAssert (minus_1 - low(Int128)) == high(Int128)
  doAssert (minus_1 - minus_170141183460469231713240559642174554113) == i_170141183460469231713240559642174554112
  doAssert (minus_1 - minus_18446744073709551616) == i_18446744073709551615
  doAssert (minus_1 - minus_18446744073709551615) == i_18446744073709551614
  doAssert (minus_1 - minus_1) == zero(Int128)
  doAssert (minus_1 - zero(Int128)) == minus_1
  doAssert (minus_1 - one(Int128)) == minus_2
  doAssert (minus_1 - i_18446744073709551615) == minus_18446744073709551616
  doAssert (minus_1 - i_18446744073709551616) == minus_18446744073709551617
  doAssert (minus_1 - i_21267647932558653948014168890775961600) == minus_21267647932558653948014168890775961601
  doAssert (minus_1 - high(Int128)) == low(Int128)

  when defined(danger):
    doAssert (zero(Int128) - low(Int128)) == low(Int128)
    doAssert (zero(Int128) - minus_170141183460469231713240559642174554113) == i_170141183460469231713240559642174554113
  doAssert (zero(Int128) - minus_18446744073709551616) == i_18446744073709551616
  doAssert (zero(Int128) - minus_18446744073709551615) == i_18446744073709551615
  doAssert (zero(Int128) - minus_1) == one(Int128)
  doAssert (zero(Int128) - zero(Int128)) == zero(Int128)
  doAssert (zero(Int128) - one(Int128)) == minus_1
  doAssert (zero(Int128) - i_18446744073709551615) == minus_18446744073709551615
  doAssert (zero(Int128) - i_18446744073709551616) == minus_18446744073709551616
  doAssert (zero(Int128) - i_21267647932558653948014168890775961600) == minus_21267647932558653948014168890775961600
  doAssert (zero(Int128) - high(Int128)) == minus_170141183460469231731687303715884105727

  when defined(danger):
    doAssert (one(Int128) - low(Int128)) == minus_170141183460469231731687303715884105727
    doAssert (one(Int128) - minus_170141183460469231713240559642174554113) == i_170141183460469231713240559642174554114
  doAssert (one(Int128) - minus_18446744073709551616) == i_18446744073709551617
  doAssert (one(Int128) - minus_18446744073709551615) == i_18446744073709551616
  doAssert (one(Int128) - minus_1) == i_2
  doAssert (one(Int128) - zero(Int128)) == one(Int128)
  doAssert (one(Int128) - one(Int128)) == zero(Int128)
  doAssert (one(Int128) - i_18446744073709551615) == minus_18446744073709551614
  doAssert (one(Int128) - i_18446744073709551616) == minus_18446744073709551615
  doAssert (one(Int128) - i_21267647932558653948014168890775961600) == minus_21267647932558653948014168890775961599
  doAssert (one(Int128) - high(Int128)) == minus_170141183460469231731687303715884105726

  when defined(danger):
    doAssert (i_18446744073709551615 - low(Int128)) == minus_170141183460469231713240559642174554113 # Error compiling with --cpu:i386
    doAssert (i_18446744073709551615 - minus_170141183460469231713240559642174554113) == low(Int128)
  doAssert (i_18446744073709551615 - minus_18446744073709551616) == i_36893488147419103231
  doAssert (i_18446744073709551615 - minus_18446744073709551615) == i_36893488147419103230
  doAssert (i_18446744073709551615 - minus_1) == i_18446744073709551616
  doAssert (i_18446744073709551615 - zero(Int128)) == i_18446744073709551615
  doAssert (i_18446744073709551615 - one(Int128)) == i_18446744073709551614
  doAssert (i_18446744073709551615 - i_18446744073709551615) == zero(Int128)
  doAssert (i_18446744073709551615 - i_18446744073709551616) == minus_1
  doAssert (i_18446744073709551615 - i_21267647932558653948014168890775961600) == minus_21267647932558653929567424817066409985
  doAssert (i_18446744073709551615 - high(Int128)) == minus_170141183460469231713240559642174554112

  when defined(danger):
    doAssert (i_18446744073709551616 - low(Int128)) == minus_170141183460469231713240559642174554112
    doAssert (i_18446744073709551616 - minus_170141183460469231713240559642174554113) == minus_170141183460469231731687303715884105727
  doAssert (i_18446744073709551616 - minus_18446744073709551616) == i_36893488147419103232
  doAssert (i_18446744073709551616 - minus_18446744073709551615) == i_36893488147419103231
  doAssert (i_18446744073709551616 - minus_1) == i_18446744073709551617
  doAssert (i_18446744073709551616 - zero(Int128)) == i_18446744073709551616
  doAssert (i_18446744073709551616 - one(Int128)) == i_18446744073709551615
  doAssert (i_18446744073709551616 - i_18446744073709551615) == one(Int128)
  doAssert (i_18446744073709551616 - i_18446744073709551616) == zero(Int128)
  doAssert (i_18446744073709551616 - i_21267647932558653948014168890775961600) == minus_21267647932558653929567424817066409984
  doAssert (i_18446744073709551616 - high(Int128)) == minus_170141183460469231713240559642174554111

  when defined(danger):
    doAssert (i_21267647932558653948014168890775961600 - low(Int128)) == minus_148873535527910577783673134825108144128
    doAssert (i_21267647932558653948014168890775961600 - minus_170141183460469231713240559642174554113) == minus_148873535527910577802119878898817695743
  doAssert (i_21267647932558653948014168890775961600 - minus_18446744073709551616) == i_21267647932558653966460912964485513216
  doAssert (i_21267647932558653948014168890775961600 - minus_18446744073709551615) == i_21267647932558653966460912964485513215
  doAssert (i_21267647932558653948014168890775961600 - minus_1) == i_21267647932558653948014168890775961601
  doAssert (i_21267647932558653948014168890775961600 - zero(Int128)) == i_21267647932558653948014168890775961600
  doAssert (i_21267647932558653948014168890775961600 - one(Int128)) == i_21267647932558653948014168890775961599
  doAssert (i_21267647932558653948014168890775961600 - i_18446744073709551615) == i_21267647932558653929567424817066409985
  doAssert (i_21267647932558653948014168890775961600 - i_18446744073709551616) == i_21267647932558653929567424817066409984
  doAssert (i_21267647932558653948014168890775961600 - i_21267647932558653948014168890775961600) == zero(Int128)
  doAssert (i_21267647932558653948014168890775961600 - high(Int128)) == minus_148873535527910577783673134825108144127

  when defined(danger):
    doAssert (high(Int128) - low(Int128)) == minus_1 # Error compiling with --cpu:i386
    doAssert (high(Int128) - minus_170141183460469231713240559642174554113) == minus_18446744073709551616
    doAssert (high(Int128) - minus_18446744073709551616) == minus_170141183460469231713240559642174554113
    doAssert (high(Int128) - minus_18446744073709551615) == minus_170141183460469231713240559642174554114
    doAssert (high(Int128) - minus_1) == low(Int128)
  doAssert (high(Int128) - zero(Int128)) == high(Int128)
  doAssert (high(Int128) - one(Int128)) == i_170141183460469231731687303715884105726
  doAssert (high(Int128) - i_18446744073709551615) == i_170141183460469231713240559642174554112
  doAssert (high(Int128) - i_18446744073709551616) == i_170141183460469231713240559642174554111
  doAssert (high(Int128) - i_21267647932558653948014168890775961600) == i_148873535527910577783673134825108144127
  doAssert (high(Int128) - high(Int128)) == zero(Int128)
